<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor’s Note Access</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px auto;
      max-width: 600px;
      text-align: center;
    }

    #wait-message,
    #puzzle-container,
    #download-section {
      margin-top: 20px;
    }

    #puzzle-container {
      display: none;
    }

    .puzzle {
      display: none;
      margin-bottom: 20px;
    }

    .puzzle h2 {
      margin-bottom: 10px;
    }

    .puzzle .puzzle-question {
      font-weight: bold;
      margin-bottom: 8px;
    }

    .puzzle .puzzle-result {
      color: red;
      margin-top: 8px;
    }

    #download-section {
      display: none;
      margin-top: 30px;
    }

    .button {
      display: inline-block;
      padding: 10px 20px;
      margin: 10px;
      font-size: 1rem;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
      border-radius: 4px;
      text-decoration: none;
      border: none;
    }

    .button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    /* Just for the cat video puzzle embed */
    #cat-video-iframe {
      width: 100%;
      height: 315px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>Doctor’s Note: Extremely Secure Download</h1>
  <div id="wait-message">
    <p>Please wait <strong>5 minutes</strong> while we verify your access to this highly confidential file.</p>
    <p id="timer-text"></p>
  </div>

  <div id="puzzle-container">
    <!-- Each puzzle is inserted dynamically, but we provide HTML shells for them. -->
    <!-- We'll have 8 puzzles. They will be randomized in order. -->

    <!-- 8 puzzle divs: each will be one puzzle, revealed in a random sequence. -->
    <div class="puzzle" id="puzzle0">
      <h2>Puzzle 1</h2>
      <div class="puzzle-question" id="question0"></div>
      <!-- Special handling for cat video puzzle in code. -->
      <div id="cat-video-0" style="display: none;">
        <iframe 
          id="cat-video-iframe" 
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1" 
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer0" style="display:none;" />
      <button class="button" id="submit0" onclick="submitAnswer(0)">Submit</button>
      <div class="puzzle-result" id="result0"></div>
    </div>

    <div class="puzzle" id="puzzle1">
      <h2>Puzzle 2</h2>
      <div class="puzzle-question" id="question1"></div>
      <div id="cat-video-1" style="display: none;">
        <iframe 
          id="cat-video-iframe" 
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer1" style="display:none;" />
      <button class="button" id="submit1" onclick="submitAnswer(1)">Submit</button>
      <div class="puzzle-result" id="result1"></div>
    </div>

    <div class="puzzle" id="puzzle2">
      <h2>Puzzle 3</h2>
      <div class="puzzle-question" id="question2"></div>
      <div id="cat-video-2" style="display: none;">
        <iframe 
          id="cat-video-iframe" 
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer2" style="display:none;" />
      <button class="button" id="submit2" onclick="submitAnswer(2)">Submit</button>
      <div class="puzzle-result" id="result2"></div>
    </div>

    <div class="puzzle" id="puzzle3">
      <h2>Puzzle 4</h2>
      <div class="puzzle-question" id="question3"></div>
      <div id="cat-video-3" style="display: none;">
        <iframe 
          id="cat-video-iframe"
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer3" style="display:none;" />
      <button class="button" id="submit3" onclick="submitAnswer(3)">Submit</button>
      <div class="puzzle-result" id="result3"></div>
    </div>

    <div class="puzzle" id="puzzle4">
      <h2>Puzzle 5</h2>
      <div class="puzzle-question" id="question4"></div>
      <div id="cat-video-4" style="display: none;">
        <iframe 
          id="cat-video-iframe"
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer4" style="display:none;" />
      <button class="button" id="submit4" onclick="submitAnswer(4)">Submit</button>
      <div class="puzzle-result" id="result4"></div>
    </div>

    <div class="puzzle" id="puzzle5">
      <h2>Puzzle 6</h2>
      <div class="puzzle-question" id="question5"></div>
      <div id="cat-video-5" style="display: none;">
        <iframe 
          id="cat-video-iframe"
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer5" style="display:none;" />
      <button class="button" id="submit5" onclick="submitAnswer(5)">Submit</button>
      <div class="puzzle-result" id="result5"></div>
    </div>

    <div class="puzzle" id="puzzle6">
      <h2>Puzzle 7</h2>
      <div class="puzzle-question" id="question6"></div>
      <div id="cat-video-6" style="display: none;">
        <iframe 
          id="cat-video-iframe"
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer6" style="display:none;" />
      <button class="button" id="submit6" onclick="submitAnswer(6)">Submit</button>
      <div class="puzzle-result" id="result6"></div>
    </div>

    <div class="puzzle" id="puzzle7">
      <h2>Puzzle 8</h2>
      <div class="puzzle-question" id="question7"></div>
      <div id="cat-video-7" style="display: none;">
        <iframe 
          id="cat-video-iframe"
          src="https://www.youtube.com/embed/J---aiyznGQ?enablejsapi=1"
          frameborder="0"
          allowfullscreen
        ></iframe>
        <p>Please watch at least <strong>10 seconds</strong> of this adorable cat video before proceeding.</p>
      </div>
      <input type="text" id="answer7" style="display:none;" />
      <button class="button" id="submit7" onclick="submitAnswer(7)">Submit</button>
      <div class="puzzle-result" id="result7"></div>
    </div>
  </div>

  <!-- Final Download Section -->
  <div id="download-section">
    <h2>Verification Successful</h2>
    <p>You can now download the compressed doctor's note below:</p>
    <!-- In reality, the link would point to your real doctors_note.zip on your server -->
    <a href="doctors_note.zip" download class="button">Download Doctor's Note (ZIP)</a>
  </div>

  <script>
    // Wait time (5 minutes = 300 seconds)
    let WAIT_TIME = 300;

    // We'll store puzzle data in an array of objects.
    // Some puzzles are "text" type, and one is "catVideo" type
    // but let's randomly assign 1 puzzle to be a cat video or more if you wish.
    // In this example, let's say we have 3 cat video puzzles total (which might be more than enough).
    // We can just define them all as text for demonstration except 3 that are cat videos.

    const puzzleData = [
      {
        type: "text",
        question: "What is 2 + 2?",
        correctAnswer: "4"
      },
      {
        type: "text",
        question: "Spell 'pneumonia' backward.",
        correctAnswer: "ainuomnep"
      },
      {
        type: "text",
        question: "Type the word 'BLUE' in lowercase.",
        correctAnswer: "blue"
      },
      {
        type: "text",
        question: "What is 15 divided by 3?",
        correctAnswer: "5"
      },
      {
        type: "text",
        question: "Type 'I will not fail again' exactly.",
        correctAnswer: "i will not fail again"
      },
      {
        type: "catVideo", // puzzle #6
        question: "Watch the cat video for at least 10 seconds before submitting.",
        correctAnswer: "watched" // We'll treat it specially in code
      },
      {
        type: "text",
        question: "What is 10 - 3?",
        correctAnswer: "7"
      },
      {
        type: "catVideo", // puzzle #8
        question: "Another cat video puzzle! Watch for 10 seconds, then type 'done'.",
        correctAnswer: "done"
      }
    ];

    // We will shuffle these puzzle objects so the order changes each time the page loads
    let puzzleOrder = shuffleArray([...Array(puzzleData.length).keys()]); 
    // puzzleOrder is an array of indices [0..7] in random order

    // This variable keeps track of which puzzle # in the random sequence we're on
    let currentPuzzleIndex = 0;

    // For the cat video puzzle, we want them to watch at least X seconds
    let catVideoWatchTimeRequired = 10; // 10 seconds
    let catVideoTimeTracker = 0;
    let catVideoInterval = null;

    // The countdown timer
    let timer;
    let remainingTime = WAIT_TIME;

    // On load, start the initial wait
    window.addEventListener('load', () => {
      startWaitTimer();
    });

    // Shuffle array function (Fisher-Yates)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function startWaitTimer() {
      const timerText = document.getElementById("timer-text");
      timer = setInterval(() => {
        if (remainingTime <= 0) {
          clearInterval(timer);
          document.getElementById("wait-message").style.display = "none";
          document.getElementById("puzzle-container").style.display = "block";
          showPuzzle(0);
        } else {
          timerText.textContent = `Time remaining before verification starts: ${remainingTime}s`;
          remainingTime--;
        }
      }, 1000);
    }

    // Show puzzle in the *shuffled* order
    // idx is the index in puzzleOrder, not the puzzle ID itself
    function showPuzzle(idx) {
      // Hide all puzzle elements first
      const puzzleElems = document.querySelectorAll('.puzzle');
      puzzleElems.forEach(el => el.style.display = 'none');

      if (idx >= puzzleData.length) {
        // If we've passed the last puzzle, show the download link
        document.getElementById("puzzle-container").style.display = "none";
        document.getElementById("download-section").style.display = "block";
        return;
      }

      const puzzleId = puzzleOrder[idx];  // the actual puzzle in puzzleData
      const puzzleElem = document.getElementById(`puzzle${idx}`);
      puzzleElem.style.display = 'block';

      // Fill puzzle question text
      const questionDiv = document.getElementById(`question${idx}`);
      questionDiv.textContent = puzzleData[puzzleId].question;

      // If this puzzle is type catVideo, show the cat video
      // Otherwise show the text input
      if (puzzleData[puzzleId].type === "catVideo") {
        document.getElementById(`cat-video-${idx}`).style.display = 'block';
        document.getElementById(`answer${idx}`).style.display = 'none';

        // Start tracking watch time
        catVideoTimeTracker = 0;
        if (catVideoInterval) {
          clearInterval(catVideoInterval);
        }
        // Increase watch count every second
        catVideoInterval = setInterval(() => {
          catVideoTimeTracker++;
        }, 1000);

      } else {
        // text puzzle
        document.getElementById(`cat-video-${idx}`).style.display = 'none';
        document.getElementById(`answer${idx}`).style.display = 'inline-block';
      }
    }

    function submitAnswer(idx) {
      const puzzleId = puzzleOrder[idx];
      const resultSpan = document.getElementById(`result${idx}`);
      const puzzleObj = puzzleData[puzzleId];

      if (puzzleObj.type === "catVideo") {
        // check watch time
        if (catVideoTimeTracker >= catVideoWatchTimeRequired) {
          // they “passed” by watching
          clearInterval(catVideoInterval);
          resultSpan.textContent = "Success! You've watched enough cat video.";
          resultSpan.style.color = "green";
          goToNextPuzzle();
        } else {
          // fail
          redirectToFailure();
        }
      } else {
        // text puzzle
        const answerInput = document.getElementById(`answer${idx}`);
        const userAnswer = answerInput.value.trim().toLowerCase();
        if (userAnswer === puzzleObj.correctAnswer) {
          resultSpan.textContent = "Correct!";
          resultSpan.style.color = "green";
          goToNextPuzzle();
        } else {
          // fail
          redirectToFailure();
        }
      }
    }

    function goToNextPuzzle() {
      currentPuzzleIndex++;
      showPuzzle(currentPuzzleIndex);
    }

    function redirectToFailure() {
      // immediate redirect to a "failure" page
      window.location.href = "failure.html";
    }
  </script>
</body>
</html>
